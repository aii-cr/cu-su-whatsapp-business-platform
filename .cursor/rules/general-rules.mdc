---
description: General rules for the project.
globs:
alwaysApply: true
---
## Rules to Follow

[Version Control]
 - Create a new branch for every complete feature using the prefix `feature/<short-description>` (or `bugfix/`, `hotfix/`, `release/`), following Git Flow conventions.  
 - Write detailed, imperative-mood commit messages referencing issue or ticket IDs; summarize **what** and **why** in ≤50 characters.

[Configuration Management]
 - Centralize **all** mutable settings (tokens, IDs, URIs, timeouts, feature flags) in `core/config.py` via Pydantic `BaseSettings`, loading from `.env`.  
 - Avoid hard-coding any values; expose every changeable parameter as an environment variable.

[Code Structure & Organization]
 - Organize code by feature under `app/` (`routes/`, `services/`, `db/models/`, `schemas/`, `utils/`).  
 - Keep files small (≤300 lines); split responsibilities into service classes and helpers to prevent monoliths.

[Testing & CI/CD]
 - Write pytest unit and integration tests for every new feature; mock external dependencies; target ≥80% coverage.  
 - Integrate tests into CI so every pull request runs the full suite before merge.

[Containerization & Deployment]
 - Use a multi-stage `Dockerfile` (slim base, non-root user, cached dependencies) and maintain `docker-compose.yml` for local dev.  
 - On each dependency or code change, verify Docker images build and containers start successfully.

[Lessons Learned & Continuous Improvement]
 - Log every non-trivial error and its resolution in `lessons_learned.md` (date, root cause, fix), organized by feature.  
 - After adding/updating any dependency, confirm that Docker, CI, and local runs remain green to avoid “works on my machine” issues.
